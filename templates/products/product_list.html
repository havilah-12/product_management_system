{% extends 'base.html' %}
{% block content %}

<!-- PAGE HEADER -->
<div class="page-header">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
    <div>
      <h3>
        <i class="bi bi-grid-3x3-gap text-primary"></i>
        Product Management
      </h3>
      <p class="text-muted mb-0 mt-1">Manage your product inventory</p>
    </div>
    <a href="{% url 'product_add' %}" class="btn btn-success">
      <i class="bi bi-plus-circle"></i>
      Add Product
    </a>
  </div>
</div>

<!-- FILTER BAR -->
<div class="card border-0 shadow-sm mb-4" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
  <div class="card-body p-3">
    <form method="get" class="row g-3">
      <div class="col-md-5">
        <label class="form-label small text-muted fw-semibold">
          <i class="bi bi-search"></i> Search Products
        </label>
        <input
          type="text"
          name="q"
          value="{{ request.GET.q }}"
          class="form-control"
          placeholder="Search by name or description..."
        >
      </div>

      <div class="col-md-4">
        <label class="form-label small text-muted fw-semibold">
          <i class="bi bi-tags"></i> Category
        </label>
        <select name="category" class="form-select">
          <option value="">All Categories</option>
          {% for c in categories %}
            <option value="{{ c.id }}"
              {% if request.GET.category == c.id|stringformat:"s" %}selected{% endif %}
            >
              {{ c.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn {% if request.GET.category %}btn-success{% else %}btn-primary{% endif %} w-100">
          <i class="bi bi-funnel"></i>
          Apply Filters
        </button>
      </div>
    </form>
  </div>
</div>

<!-- PRODUCT TABLE -->
<div class="table-responsive product-table-scroll" style="max-height: 70vh; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 12px;">
  <table class="table align-middle table-hover mb-0">
    <thead>
      <tr>
        <th style="width: 150px;">
          <i class="bi bi-image"></i> Image
        </th>
        <th>
          <i class="bi bi-box"></i> Name
        </th>
        <th>
          <i class="bi bi-currency-rupee"></i> Price
        </th>
        <th>
          <i class="bi bi-tag"></i> Category
        </th>
        <th>
          <i class="bi bi-calendar"></i> Created Date
        </th>
        <th class="text-end">
          <i class="bi bi-gear"></i> Actions
        </th>
      </tr>
    </thead>

    <tbody>
      {% for p in products %}
      <tr>
        <td>
          {% if p.image %}
            <img src="{{ p.image.url }}"
                 class="img-thumbnail"
                 style="height:120px; width:120px; object-fit:contain; background-color: #f8f9fa;">
          {% else %}
            <div class="d-flex align-items-center justify-content-center bg-light rounded"
                 style="height:120px; width:120px;">
              <i class="bi bi-image text-muted" style="font-size: 1.5rem;"></i>
            </div>
          {% endif %}
        </td>

        <td>
          <div class="fw-semibold" style="color: var(--text-primary);">{{ p.name }}</div>
          {% if p.description %}
            <small class="text-muted d-block mt-1" style="font-size: 0.85rem;">
              {{ p.description|truncatewords:10 }}
            </small>
          {% endif %}
        </td>

        <td>
          <span class="fw-bold text-success" style="font-size: 1.1rem;">
            â‚¹{{ p.price|floatformat:2 }}
          </span>
        </td>

        <td>
          <span class="badge bg-primary" style="font-size: 0.875rem; padding: 0.5rem 0.75rem;">
            <i class="bi bi-tag-fill"></i>
            {{ p.category.name }}
          </span>
        </td>

        <td>
          <small class="text-muted">
            <i class="bi bi-clock"></i>
            {{ p.created_at|date:"h:i A" }} IST
          </small>
          <br>
          <small class="text-muted" style="font-size: 0.75rem;">
            {{ p.created_at|date:"M d, Y" }}
          </small>
        </td>

        <td class="text-end">
          <div class="btn-group" role="group">
            <a href="{% url 'product_edit' p.id %}"
               class="btn btn-sm btn-outline-primary"
               title="Edit Product">
              <i class="bi bi-pencil-square"></i>
              Edit
            </a>
            <a href="{% url 'product_delete' p.id %}"
               class="btn btn-sm btn-outline-danger"
               title="Delete Product">
              <i class="bi bi-trash"></i>
              Delete
            </a>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6">
          <div class="empty-state">
            <i class="bi bi-inbox"></i>
            <h5 class="mt-3 mb-2">No products found</h5>
            <p class="text-muted mb-3">Get started by adding your first product</p>
            <a href="{% url 'product_add' %}" class="btn btn-success">
              <i class="bi bi-plus-circle"></i>
              Add Your First Product
            </a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if products %}
<div class="mt-4 d-flex justify-content-between align-items-center flex-wrap gap-3">
  <div class="text-muted small">
    <i class="bi bi-info-circle"></i>
    Showing <strong>{{ products|length }}</strong> of <strong>{{ total_products }}</strong> product{{ total_products|pluralize }}
  </div>
  
  <!-- Pagination Controls -->
  {% if products.has_other_pages %}
  <nav aria-label="Product pagination">
    <ul class="pagination pagination-sm mb-0">
      {% if products.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ products.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" aria-label="Previous">
            <span aria-hidden="true">&laquo; Previous</span>
          </a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">&laquo; Previous</span>
        </li>
      {% endif %}

      {% for num in products.paginator.page_range %}
        {% if products.number == num %}
          <li class="page-item active">
            <span class="page-link">{{ num }}</span>
          </li>
        {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
          <li class="page-item">
            <a class="page-link" href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">{{ num }}</a>
          </li>
        {% endif %}
      {% endfor %}

      {% if products.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ products.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" aria-label="Next">
            <span aria-hidden="true">Next &raquo;</span>
          </a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">Next &raquo;</span>
        </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>
{% endif %}

<style>
  .product-table-scroll {
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .product-table-scroll table thead {
    position: sticky;
    top: 0;
    z-index: 10;
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .product-table-scroll::-webkit-scrollbar {
    width: 10px;
  }

  .product-table-scroll::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  .product-table-scroll::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
  }

  .product-table-scroll::-webkit-scrollbar-thumb:hover {
    background: #555;
  }

  .pagination .page-link {
    color: var(--primary-color);
    border-color: var(--border-color);
    transition: all 0.2s ease;
  }

  .pagination .page-link:hover {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
  }

  .pagination .page-item.active .page-link {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    color: white;
  }

  .pagination .page-item.disabled .page-link {
    color: #6c757d;
    background-color: #f8f9fa;
    border-color: var(--border-color);
    cursor: not-allowed;
  }

  #imageModal .modal-body img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
  }
</style>


{% endblock %}